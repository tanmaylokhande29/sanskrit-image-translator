


#  Imports
import pytesseract
import cv2
import numpy as np
import matplotlib.pyplot as plt
from difflib import get_close_matches, SequenceMatcher
from PIL import Image
from google.colab import files
import re

#  Sanskrit-to-English Dictionary
sanskrit_to_english = {
    'à¤¨à¤®à¤¸à¥à¤¤à¥‡': 'bow (namaste)', 'à¤¬à¤¾à¤²à¤ƒ': 'boy', 'à¤¬à¤¾à¤²à¤¾': 'girl', 'à¤¸': 'he', 'à¤¸à¤¾': 'she', 'à¤¤à¥Œ': 'they (m)',
    'à¤¤à¥‡': 'they (f) many', 'à¤ªà¤ ': 'read', 'à¤ªà¤ à¤¤à¤¿': 'reads', 'à¤²à¤¿à¤–': 'write', 'à¤ªà¤š': 'cook', 'à¤–à¤¾à¤¦': 'eat',
    'à¤šà¤²': 'walk', 'à¤¹à¤¸': 'laugh', 'à¤§à¤¾à¤µ': 'run', 'à¤–à¥‡à¤²': 'play', 'à¤µà¤¦': 'speak', 'à¤¶à¤¾à¤–à¤¾': 'branch',
    'à¤ªà¤¤': 'fall', 'à¤…à¤®à¥à¤¬à¤¾': 'mother', 'à¤œà¤¨à¤•': 'father', 'à¤ªà¥à¤¤à¥à¤°': 'son', 'à¤à¤µ': 'also', 'à¤š': 'and',
    'à¤¨': 'no', 'à¤•à¥à¤¤à¥à¤°': 'where?', 'à¤…à¤¤à¥à¤°': 'here', 'à¤¤à¤¤à¥à¤°': 'there', 'à¤…à¤œ': 'goat', 'à¤—à¤œ': 'elephant',
    'à¤…à¤¶à¥à¤µ': 'horse', 'à¤¸à¤¿à¤‚à¤¹': 'lion', 'à¤¤à¤¿': 'does (singular)', 'à¤¤à¤ƒ': 'does (two)', 'à¤¤à¤¿à¤ƒ': 'does (many)'
}

# Similarity
def get_similarity(a, b):
    return SequenceMatcher(None, a, b).ratio()

# processing of img
def process_image(file_data, filename):

    image = cv2.imdecode(np.frombuffer(file_data, np.uint8), cv2.IMREAD_COLOR)
    rgb = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)


    plt.imshow(rgb)
    plt.title(f"Uploaded Image: {filename}")
    plt.axis("off")
    plt.show()


    gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)
    gray = cv2.bilateralFilter(gray, 11, 17, 17)
    thresh = cv2.adaptiveThreshold(
        gray, 255, cv2.ADAPTIVE_THRESH_GAUSSIAN_C, cv2.THRESH_BINARY, 31, 9
    )


    config = r'--oem 3 --psm 6 -l san'
    text = pytesseract.image_to_string(thresh, config=config).strip()
    clean_text = re.sub(r'[^à¤€-à¥¿]+', '', text)
    print(f"ğŸ” OCR Output: `{text}`")
    print(f"ğŸ§¹ Cleaned Text: `{clean_text}`")

   #accuracy
    best_match = None
    best_score = 0.0
    for word in sanskrit_to_english:
        score = get_similarity(clean_text, word)
        if score > best_score:
            best_score = score
            best_match = word

    accuracy_percent = round(best_score * 100, 2)

    if best_score >= 0.6:
        meaning = sanskrit_to_english[best_match]
        print(f"ğŸŸ¡ Closest Match: `{best_match}`")
    else:
        meaning = "âŒ Not found in dictionary"

    # acc output
    if accuracy_percent >= 90:
        status = "âœ… Excellent"
    elif accuracy_percent >= 70:
        status = "âš ï¸ Fair"
    else:
        status = "âŒ Poor"

    print(f"ğŸ“Š OCR Match Accuracy: {accuracy_percent}% ({status})")
    print(f"âœ… English Meaning: {meaning}")
    print("--------------------------------------------------")

# STEP 6: Upload Loop
while True:
    print("\nğŸ“¤ Upload a Sanskrit word image (or press stop to end):")
    uploaded = files.upload()

    if not uploaded:
        break

    for filename, filedata in uploaded.items():
        process_image(filedata, filename)
